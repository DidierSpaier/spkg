#!/bin/sh -e

CWD=`pwd`
VERSION=1.0rc7

rm -rf spkg-$VERSION
tar xzvf spkg-$VERSION.tar.gz
cd spkg-$VERSION
./configure --prefix=/usr --mandir=/usr/man --enable-static-spkg=only
make
make install DESTDIR=$CWD/slack-pkg
gzip -9 $CWD/slack-pkg/usr/man/man8/spkg.8
ln -snf spkg.8.gz $CWD/slack-pkg/usr/man/man8/ipkg.8.gz
ln -snf spkg.8.gz $CWD/slack-pkg/usr/man/man8/upkg.8.gz
ln -snf spkg.8.gz $CWD/slack-pkg/usr/man/man8/dpkg.8.gz
ln -snf spkg.8.gz $CWD/slack-pkg/usr/man/man8/lpkg.8.gz
rm $CWD/slack-pkg/usr/man/man8/?pkg.8
mkdir -p $CWD/slack-pkg/install
cat slack-desc > $CWD/slack-pkg/install/slack-desc
cd $CWD/slack-pkg
makepkg -l y -c n $CWD/spkg-$VERSION-i486-1.tgz
cd $CWD
rm -rf spkg-$VERSION slack-pkg
